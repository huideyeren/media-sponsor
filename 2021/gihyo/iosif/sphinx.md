# PyCon JP 2021 イベントレポート

## セッション「他人が書いたコードのリファレンスをSphinxで作る方法」 - 杉山 剛氏

杉山氏の「[他人が書いたコードのリファレンスをSphinxで作る方法](https://2021.pycon.jp/time-table/?id=271453)」というセッションの紹介をいたします。

杉山氏は事務系のお仕事を33年間勤める傍ら独学でPythonを学び、業務のデータ分析でも最近Pythonを使うようになった方です。また、書籍のレビューを積極的に行っており、過去に14冊もレビューし、さらには現在も1冊レビューの最中とのことです。

このセッションでは、他者が書いたPythonのコードにdocstringをつけていくことを通じて、Pythonコードの保守性をあげていくことを題材としています。Pythonにはコードのドキュメントをわかりやすく記載するdocstringというしくみがあり、これを記載すればSphinxなどのツールを使ってコードのリファレンスをお手軽に作ることができます。

今回のセッションでは、初老の事務系サラリーマンSさん（仮名）が急遽退社する事になってしまった後輩から引き継いだdocstringの無いコードにdocstringを書きながら、コードの全容を把握するためのドキュメントを書いていくというエピソードを題材としています。あくまでもフィクションとのことですが、問題のコードは後輩がデータ分析で書いたコードが気がつくと業務で利用されることになり、その間にWebアプリ化されてコードが書けない人も使うようになったコードです。業務で使われているのだから、メンテナンスができなくなることは死活問題です。

しかし、そのコードにはいろいろな問題がありました。Pythonにはというコーディング規範があるのですが、そのコードは全くPEP-8を守っていない上に、処理内容と辻褄が合わないコメントや冗長な処理など、読みづらくなる要素がてんこ盛りなコードでした。もちろん、テストもありません。Sさんは処理そのものは手を加えずにPEP-8準拠にコードを書き換え間違っているコメントを直していきました。もちろん、docstringを書き加えながら。書き上げたdocstringは、Sphinxによって一瞬でドキュメントになったのでした。そのドキュメントの甲斐あって、テストの追加もリファクタリングも無事できましたとさ。めでたしめでたし。

筆者の経験でも、ドキュメントの無いコードは厄介なモノということを理解しています。しかし、だいたいコードの変更が先になってしまいドキュメントの無いコードが量産されることはよくあることです。そして、そのドキュメントの無いコードをメンテナンスする際に思うことは、「ちゃんとドキュメント書いておけばよかった……」ということだったりします。筆者自身が書いたコードでさえ昔書いたコードの全容を忘れてしまうものですから、他者が書いたドキュメントのないコードを理解するということはあまりにも大変なことなのです。そういう大変なことをSさんはやり遂げたわけです。
